doctype html
html.playbody
  head
    meta(charset="utf-8")
    meta(name="viewport",content="width=device-width, initial-scale=1, maximum-scale=1")
    meta(http-equiv="X-UA-Compatible",content="IE=edge, chrome=1")
    meta(name="renderer",content="webkit")
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    link(rel="stylesheet", href='/stylesheets/DPlayer.min.css')
  body.playbody
    if !phoneviewer
      #player
      script(src="/javascripts/fixie.js")
      script(src="/javascripts/hls.min.js")
      script(src="/javascripts/DPlayer.min.js")
      script(src="/javascripts/jquery.min.js")
      script(src="/layer/layer.js")
      - var theposter;
      if poster
        - theposter = poster;
      else
        - theposter = `/videos/${id}/1.jpg`;
      script.
        function getParentUrl() {
          let url = null;
          if (parent !== window) {   
              try {  
                  url = parent.location.href;   
              }catch (e) {   
                  url = document.referrer;   
              }   
            }  
            return url;  
        }
        let parenturl = getParentUrl();
        if(!parenturl) {
          parenturl = (window.location != window.parent.location)?document.referrer:document.location;
        }
        const antiurl = "#{antiurl}";
        const token = "#{token}";
        let m3u8 = '/videos/#{id}/index.m3u8';
        if(token!=''){
          m3u8 = `${m3u8}?token=${token}`;
        }
        const dp = new DPlayer({
          container: document.getElementById('player'),
          screenshot: true,
          lang: 'zh-cn',
          autoplay: false,
          logo: '#{logo}',
          mutex: true,
          video: {
            url: m3u8,
            pic: '#{theposter}',
            thumbnails: '/videos/#{id}/thumbnails.jpg',
            type: 'hls'
          },
          subtitle: {
            url: '/videos/#{id}/1.vtt',
            fontSize: '25px',
            bottom: '10%'
          }
        });
        dp.on('canplay', () => {
          $(".dplayer-video").attr("x5-video-player-type","h5");
          $(".dplayer-video").attr("x5-video-orientation","landscape");
          $(".dplayer-video").attr("x5-video-player-fullscreen","true");
        });